<!DOCTYPE html>
<html lang="zxx">
   <head>
      <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta name="description" content="">
      <meta name="author" content="">
      <link rel="shortcut icon" href="images/favicon.png">
      <title>Dijital</title>
      <link href="css/bootstrap.css" rel="stylesheet">
      <link href="css/fontawesome.css" rel="stylesheet">
      <link href="css/smooth-scrollbar.css" rel="stylesheet">
      <link href="css/style.css" rel="stylesheet">
      <link href="css/responsive.css" rel="stylesheet">
      <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
      <!--[if lt IE 9]>
      <script src="js/html5shiv.js"></script>
      <script src="js/respond.min.js"></script>
      <![endif]-->
   </head>
   <body>
      <div class="menu-ovelay"></div>
      <div class="dash">
         <div class="dash-nav dash-nav-dark">
            <div class="leftsecpos">
               <header>
                  <div class="leftprosec d-flex justify-content-center align-items-center">
                     <div class="usermainproimg"><img src="images/user.png" alt="" /></div>
                     <div class="usermaindetail">
                        <h5>Root Admin</h5>
                        <h5 style="font-weight: normal;">25 Proje Teknoloji</h5>
                        <h6>Tedarik Zinciri Yöneticisi</h6>
                     </div>
                  </div>
                  <a href="#!" class="menu-toggle desknonecancleicon"> <i class="fa fa-times"></i></a>
               </header>
               <div class="leftnavsearch d-flex flex-column h-100 justify-content-center">
                  <div class="leftnavbarsec navMB" style="flex:1.1">
                     <nav class="dash-nav-list accordion dash-nav-up" id="accordionExample">
                        <ul>
                           <li>
                              <a href="egitimler.html" class="dash-nav-item">
                                 <i class="egitimler-icon iconsize">
                                    <img class="upnavicon" src="images/icons/egitim.svg" alt="" />

                                 </i>
                                 Eğitimler
                              </a>
                           </li>
                           <li class="collapsed" data-bs-toggle="collapse" data-bs-target="#flush-collapseOne">
                              <a href="#" class="dash-nav-item">
                                 <i class="analiz-icon iconsize">
                                    <img class="upnavicon" src="images/icons/analiz.svg" alt="" />
                                 </i>
                                 Analiz
                                 <i class="fa-solid fa-chevron-up arrowNav ms-2"></i>
                              </a>
                              <div class="accordion accordion-flush dash-nav-accordion" id="accordionFlushExample">
                                 <ul id="flush-collapseOne" class="accordion-collapse collapse">
                                    <li>
                                       <a href="#" class="accordion-nav-item">
                                          <img src="images/icons/sera.png">
                                          Sera Gazı Emisyonu Tanımlama
                                       </a>
                                    </li>
                                    <li>
                                       <a href="#" class="accordion-nav-item">
                                          <img src="images/icons/sürdürülebilirlik.png">
                                          Sürdürülebilirlik İndeksi Hesaplama
                                       </a>
                                    </li>
                                    <li>
                                       <a href="#" class="accordion-nav-item">
                                          <img src="images/icons/facilty.svg" class="accordion-svg">
                                          Facilty Tanımlama
                                       </a>
                                    </li>
                                 </ul>
                              </div>
                           </li>
                           <li><a href="raporlar.html" class="dash-nav-item">
                                 <i class="raporlar-icon iconsize">
                                    <img class="upnavicon" src="images/icons/raporlar.svg" alt="" />
                                 </i>Raporlar</a></li>
                           <!-- <li><a href="timeyaz.html" class="dash-nav-item">
                                 <i class="timeyaz-icon iconsize">
                                    <img class="upnavicon" src="images/icons/tim.svg" alt="" /></i>
                                 TİM’e Yaz</a></li> -->
                        </ul>
                     </nav>
                  </div>
                  <div class="dividerNav navMB"></div>
                  <div class="leftnavbarsec leftnavbarbottom navMB mt-auto">
                     <h3>TERCİHLER</h3>
                     <nav class="dash-nav-list accordion" id="accordionExample">
                        <ul>
                           <li><a href="yetkilendirme.html" class="dash-nav-item"><i
                                    class="yetkilendirme-icon iconsize"><img class="navicon"
                                       src="images/yetkilendirme-nav-icon.svg" alt="" /><img class="navicon-h"
                                       src="images/yetkilendirme-nav-icon-h.svg" alt="" /></i>Yetkilendirme</a></li>
                           <li><a href="ifremidegistir.html" class="dash-nav-item"><i
                                    class="ifremidegistir-icon iconsize"><img class="navicon"
                                       src="images/ifremidegistir-nav-icon.svg" alt="" /><img class="navicon-h"
                                       src="images/ifremidegistir-nav-icon-h.svg" alt="" /></i>Şifremi Değiştir</a></li>
                           <li><a href="facilty-tanimlama.html" class="dash-nav-item"><i
                                    class="faciltytanimlama-icon iconsize"><img class="navicon"
                                       src="images/faciltytanimlama-nav-icon.svg" alt="" /><img class="navicon-h"
                                       src="images/faciltytanimlama-nav-icon-h.svg" alt="" /></i>Facilty Tanimlama</a></li>
                           <li><a href="gizlilik-politikas.html" class="dash-nav-item"><i
                                    class="gizlilikpolitikas-icon iconsize"><img class="navicon"
                                       src="images/gizlilikpolitikas-nav-icon.svg" alt="" /><img class="navicon-h"
                                       src="images/gizlilikpolitikas-nav-icon-h.svg" alt="" /></i>Gizlilik Politikası</a>
                           </li>
                        </ul>
                     </nav>
                  </div>
               </div>
               <div class="leftftmenu">
                  <div class="ftlogo"><a href=""><img src="images/tim-ft-logo.svg" alt="" /></a></div>
               </div>
            </div>
         </div>
         <div class="dash-app">
            <header class="dash-toolbar">
               <div class="toolbarpadd">
                  <div class="topbavbarsec">
                     <div class="mobilebaricon desk-none"><a href="#!" class="menu-toggle"> <i class="fa fa-bars"></i></a></div>
                     <div class="toolbarleftrightsec">
                        <div class="notibellicon"><a href=""><img src="images/notification-icon.svg" alt="" /></a></div>
                        <div class="toptoolbarnot">
                           <div class="heduserphoto"><img src="images/avatar-img.svg" alt="" /></div>
                           <div>
                              <div class="leftaddicon usericonTigger dropmen"><a href="#">Dijital Mentor <img src="images/down-arrow.svg" alt=""></a></div>
                              <div class="topuserDropdown">
                                 <ul>
                                    <li><a href="">Eğitimler</a></li>
                                    <li><a href="">Analiz</a></li>
                                    <li><a href="">Raporlar</a></li>
                                    <li><a href="">Profil</a></li>
                                    <li><a href="">TİM’e Yaz</a></li>
                                 </ul>
                              </div>
                           </div>
                        </div>
                        <div class="welcomesec mobilenone">
                           <h3>Merhaba Root,</h3>
                           <p>Talep etmiş olduğunuz tedarik zinciri raporunu oluşturdum. Bu alana tıklayarak rapora erişim sağlayabiliriniz.</p>
                        </div>
                     </div>
                  </div>
               </div>
            </header>
            <div class="dash-content">
               <div class="maintitlesec bluebg">
                  <h1><img src="images/pot-icon.svg" alt="" /> STATIONARY COMBUSTION</h1>
               </div>
               <div class="middlesection">
                  <div class="container">
                     <div class="formboxsec">
                        <form id="stationaryCombustionForm" method="post" action="">
                           <div class="row">
                              <div class="col-md-6">
                                 <div class="formtitle">
                                    <h3>GİRDİ ALANI</h3>
                                    <p>Lütfen salınım değerlerini hesaplamak için aşağıdaki alanları doldurun:</p>
                                 </div>
                                 <div class="alaniform formmaxwid">
                                    <div class="mb-3">
                                       <label class="form-label">Facilty ID</label>
                                       <div class="selct-dropdown fullwidthselectbox selroundbox">
                                          <select id="facility_id">
                                             <option value="0">Facilty ID</option>
                                              @foreach(DB::table("dropdown_menu_secenekler")->where("dropdown_id", "facility_id")->get() as $secenek)
                                                    <option value="{{ $secenek->deger }}">{{ $secenek->deger }}</option>
                                              @endforeach
                                          </select>
                                       </div>
                                    </div>
                                    <div class="mb-3">
                                       <label class="form-label">Year</label>
                                       <div class="selct-dropdown fullwidthselectbox selroundbox">
                                          <select id="year">
                                             <option value="0">Year</option>
                                              @foreach(DB::table("dropdown_menu_secenekler")->where("dropdown_id", "year")->get() as $secenek)
                                                  <option value="{{ $secenek->deger }}">{{ $secenek->deger }}</option>
                                              @endforeach
                                          </select>
                                       </div>
                                    </div>
                                    <div class="mb-3">
                                       <label class="form-label">Fuel</label>
                                       <div class="selct-dropdown fullwidthselectbox selroundbox">
                                          <select id="fuel">
                                             <option value="0">Fuel</option>
                                              @foreach(DB::table("dropdown_menu_secenekler")->where("dropdown_id", "fuel")->get() as $secenek)
                                                  <option value="{{ $secenek->deger }}">{{ $secenek->deger }}</option>
                                              @endforeach
                                          </select>
                                       </div>
                                    </div>
                                    <div class="mb-3">
                                       <label class="form-label">Amount of fuel</label>
                                       <div>
                                          <div class="selroundbox amountoffuelbox">
                                             <div class="inputselectflex">
                                                <div class="griinput">
                                                   <input class="borinput" id="amount_of_fuel" type="text" name="" placeholder="Giriniz">
                                                </div>
                                                <div class="selct-dropdown fullwidthselectbox">
                                                   <label class="form-label">Units</label>
                                                   <select id="units">
                                                      <option value="0">Seçiniz</option>
                                                       @foreach(DB::table("dropdown_menu_secenekler")->where("dropdown_id", "fuel")->get() as $secenek)
                                                           <option value="{{ $secenek->deger }}">{{ $secenek->deger }}</option>
                                                       @endforeach
                                                   </select>
                                                </div>
                                             </div>
                                          </div>
                                       </div>
                                    </div>
                                 </div>
                              </div>
                              <div class="col-md-6">
                                 <div class="rightformPL">
                                    <div class="formtitle">
                                       <h3>SONUÇ ALANI</h3>
                                       <p>Girdi Alanı'nda girdiğiniz değerlere göre salınan gaz miktarları aşağıdaki gibidir:</p>
                                    </div>
                                    <div class="sonucalaniformlist">
                                       <ul>
                                          <li>
                                             <div>
                                                <span>CO<sub>2</sub></span>
                                                <input type="text" name="" id="co2" placeholder="">
                                             </div>
                                          </li>
                                          <li>
                                             <div>
                                                <span>CH<sub>4</sub></span>
                                                <input type="text" name="" id="ch4" placeholder="">
                                             </div>
                                          </li>
                                          <li>
                                             <div>
                                                <span>N<sub>2</sub>O</span>
                                                <input type="text" name="" id="n2o" placeholder="">
                                             </div>
                                          </li>
                                          <li>
                                             <div>
                                                <span>CO<sub>2</sub><sup>e</sup></span>
                                                <input type="text" name="" id="co2e" placeholder="">
                                             </div>
                                          </li>
                                       </ul>
                                    </div>
                                    <div class="sublinkbnt">
                                       <input type="button" id="resetDataConfirmBtn" name="Kaydet" value="Sıfırla">
                                       <input type="button" id="storeFormData" name="Kaydet" value="Kaydet" hesaplama_edit_id="-1">
                                    </div>
                                 </div>
                              </div>
                           </div>
                        </form>
                     </div>
                     <div class="formtablesec">
                        <h4>Hesaplamalar</h4>
                        <div class="table-responsive fortab samwd">
                           <table id="storeDataTable" class="table table-bordered cstmTable basicTable cusrmrTable tablehovetr">
                              <thead>
                                 <tr>
                                    <th class="smw fnt14">Facilty ID</th>
                                    <th class="fnt14">Year</th>
                                    <th class="fnt14">Fuel</th>
                                    <th class="lefttext fnt14">Amount of <br>Fuel</th>
                                    <th class="fnt14">Units</th>
                                    <th class="fnt15"><span>CO<sub>2</sub></span></th>
                                    <th class="fnt15"><span>CH<sub>4</sub></span></th>
                                    <th class="fnt15"><span>N<sub>2</sub>O</span></th>
                                    <th class="fnt15"><span>CO<sub>2</sub><sup>e</sup></span></th>
                                    <th class="smw">&nbsp;</th>
                                 </tr>
                              </thead>
                              <tbody class="boxr">
                                 @foreach(DB::table("hesaplamalar")->get() as $hesaplama)
                                     <tr  class="hesaplama_row" id="hesaplamalar_id_{{ $hesaplama->id }}">
                                        <td>{{ $hesaplama->facility_id }}</td>
                                        <td>{{ $hesaplama->year }}</td>
                                        <td>{{ $hesaplama->fuel }}</td>
                                        <td>{{ $hesaplama->amount_of_fuel }}</td>
                                        <td>{{ $hesaplama->units }}</td>
                                        <td>{{ $hesaplama->co2 }}</td>
                                        <td>{{ $hesaplama->ch4 }}</td>
                                        <td>{{ $hesaplama->n2o }}</td>
                                        <td>{{ $hesaplama->co2e }}</td>
                                        <td class="tableright">
                                           <a class="tabbtn hesaplama_row_sil" onclick="delete_hesaplamalar_row({{ $hesaplama->id }})" hesaplama_id="{{ $hesaplama->id }}">Sil</a><br>
                                           <a class="tabbtn hesalama_row_duzenle" hesaplama_id="{{ $hesaplama->id }}">Düzenle</a><br>
                                        </td>
                                     </tr>
                                 @endforeach
                              </tbody>
                           </table>
                        </div>
                     </div>
                  </div>
               </div>
            </div>
         </div>
      </div>

      <script src="js/jquery-3.6.0.js"></script>
      <script src="js/popper.min.js"></script>
      <script src="js/spur.js"></script>
      <script src="js/bootstrap.js"></script>
      <script src="js/slectdropdown.js"></script>
      <script>
         $(document).ready(function() {
             $('.usericonTigger').click(function(evt) {
                 $('.topuserDropdown').toggleClass('showtopuserDropdown');
             });

             $('body').click(function(evt){
               if($(evt.target).closest('.usericonTigger, .topuserDropdown').length)
               return;
               $('.topuserDropdown').removeClass('showtopuserDropdown');
            });
         });
      </script>
      <script src="js/jquery.basictable.min.js"></script>
      <script>
          $(document).ready(function() {
            $('.basicTable').basictable({
              breakpoint: 767
            });
          });
      </script>
      <script src="js/form-data.js"></script>

      <script src="js/jquery.nicescroll.min.js"></script>
      <script>
        $(document).ready(function() {
          $(".boxscroll").niceScroll({cursorborder:"",cursorcolor:"#0D1840",cursoropacitymax:0.7,boxzoom:true,touchbehavior:true}); //
        });
      </script>

      <script>
          function hesaplamalar_row(data)
          {
              return `<tr class="hesaplama_row" id="hesaplamalar_id_${data[0]}">
                          <td>${data[1]}</td>
                          <td>${data[2]}</td>
                          <td>${data[3]}</td>
                          <td>${data[4]}</td>
                          <td>${data[5]}</td>
                          <td>${data[6]}</td>
                          <td>${data[7]}</td>
                          <td>${data[8]}</td>
                          <td>${data[9]}</td>
                          <td class="tableright">
                              <a class="tabbtn hesaplama_row_sil" onclick="delete_hesaplamalar_row(${data[0]})" hesaplama_id="${data[0]}">Sil</a><br>
                              <a class="tabbtn hesalama_row_duzenle" hesaplama_id="${data[0]}">Düzenle</a><br>
                          </td>
                      </tr>`;
          }

          function ajax_template(type, url, data, success_function, extra, error_function)
          {
              data._token = "{{ csrf_token() }}"

              var ajaxObject = {
                  type: type,
                  url: url,
                  data: data,
                  success: success_function,
                  error: error_function,
                  headers: {'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')}
              }

              if(extra != null && extra != "") // Extra must be like ["contentType:false", "processData:false"]
              {
                  extra.forEach(function(item, index) {
                      var key = item.split(":")[0];
                      var value = item.split(":")[1];

                      if(value == "false")
                      {
                          value = false;
                      }else if(value == "true")
                      {
                          value = true;
                      }

                      ajaxObject[key] = value;
                  })
              }

              $.ajax(ajaxObject)
          }

          var aof_input_timeout;

          $(".alaniform select").on("change", function () {
              if(check_input_field())
              {
                  send_ajax_set_results()
              }
          })

          $("#amount_of_fuel").on("keydown", function () {
              clearTimeout(aof_input_timeout);

              aof_input_timeout = setTimeout(function () {
                  if(check_input_field())
                  {
                      send_ajax_set_results()
                  }
              }, 500)
          })

          $("#resetDataConfirmBtn").on("click", function () {
              let ids = ["co2", "ch4", "n2o", "co2e"];

              for(let i = 0;i < ids.length;i++)
              {
                  $("#" + ids[i]).val("");
              }

              $(".select-selected").each(function (index, element) {
                  $(element).text($(element).parent().parent().find(".form-label").text());
              })

              $(".same-as-selected").each(function (index, element) {
                  $(element).removeClass("same-as-selected");
              })

              $(".alaniform select").each(function (index, element) {
                  $(element).val(0)
              })

              $("#amount_of_fuel").val("")

              $("#storeFormData").attr("hesaplama_edit_id", "-1");
          })

          $("#storeFormData").on("click", function () {
              if(check_input_field() && check_result_field())
              {
                  let id = $(this).attr("hesaplama_edit_id");

                  let data = {
                      id: id,
                      facility_id: $("#facility_id").val(),
                      year: $("#year").val(),
                      fuel: $("#fuel").val(),
                      amount_of_fuel: $("#amount_of_fuel").val(),
                      unit: $("#units").val(),
                      co2: $("#co2").val(),
                      ch4: $("#ch4").val(),
                      n2o: $("#n2o").val(),
                      co2e: $("#co2e").val()
                  }

                  ajax_template("POST", "/store_calculation", data, function (response) {
                      if(id == "-1")
                      {
                            hesaplamalara_ekle(response);
                      }else {
                          hesaplamalar_duzenle(response);
                      }
                  }, [], function (error) {
                      console.log(error);
                  })
              }
          })

          $(document).on("click", ".hesalama_row_duzenle", function () {
              $(".same-as-selected").each(function (index, element) {
                  $(element).removeClass("same-as-selected");
              })

              let table_data = $(this).closest(".hesaplama_row").find("td");
              $("#storeFormData").attr("hesaplama_edit_id", $(this).attr("hesaplama_id"));

              let select_fields = [1,1,1,0,1,0,0,0,0];
              let data_fields = ["#facility_id", "#year", "#fuel", "#amount_of_fuel", "#units", "#co2", "#ch4", "#n2o", "#co2e"];

              for(let i = 0;i < data_fields.length;i++)
              {
                  let val = table_data.eq(i).text();

                  $(data_fields[i]).val(val);

                  if(select_fields[i])
                  {
                      set_select_option(data_fields[i], val)
                  }
              }
          })

          function check_input_field ()
          {
              $(".alaniform select").each(function (index, element) {
                  if($(element).val() == 0)
                  {
                      return false;
                  }
              })

              let yakit_miktari = $("#amount_of_fuel").val();

              if(yakit_miktari == "")
              {
                  return false;
              }

              return true;
          }

          function check_result_field ()
          {
              $(".sonucalaniformlist input").each(function (index, element) {
                  if($(element).val() == "")
                  {
                      return false;
                  }
              })

              return true;
          }

          function send_ajax_set_results()
          {
              let unit = $("#units").val();
              let fuel = $("#fuel").val();
              let yakit_miktari = $("#amount_of_fuel").val();

              ajax_template("POST", "/calculate", {birim: unit, yakit: fuel, miktar: yakit_miktari}, function (response) {
                  if(response.length != 0)
                  {
                    let ids = ["co2", "ch4", "n2o", "co2e"];

                      for(let i = 0;i < ids.length;i++)
                      {
                          $("#" + ids[i]).val(response[i]);
                      }
                  }
              }, [], function (error) {
                  console.log(error);
              })
          }

          function hesaplamalara_ekle(data)
          {
              $("tbody.boxr").append(hesaplamalar_row(data));
          }

          function hesaplamalar_duzenle(data)
          {
              for(let i = 0;i < data.length;i++)
              {
                  let id = data[0];

                  $("#hesaplamalar_id_" + id + " td").eq(i).text(data[i + 1])
              }
          }

          function delete_hesaplamalar_row(id)
          {
              ajax_template("POST", "/delete_calculation", {id: id}, function (response) {
                  $("#hesaplamalar_id_" + id).remove();
              }, [], function (error) {
                  console.log(error);
              })
          }

          function set_select_option(id, value)
          {
              $(id).parent().find(".select-selected").text(value);

              $(id).parent().find(".select-items div").each(function (index, element) {
                  if($(element).text() == value)
                  {
                      $(element).addClass("same-as-selected");
                  }
              })
          }
      </script>

   </body>
</html>

